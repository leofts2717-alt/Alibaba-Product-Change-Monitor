AliMonitor - 阿里国际站商品排名与变动监控系统
AliMonitor 是一个基于 Python + Playwright 的自动化监控工具，专为阿里国际站（Alibaba.com）运营人员设计。它能够实时监控后台商品列表，精准捕捉新品发布、老品重发、内容修改以及排名被动上升等动作，并生成详细的 CSV 报表。
当前版本: V18.1
核心特性: 智能去重 / 自动窗口锁定 / 熔断防御 / 格式自修复
✨ 核心功能
🔥 智能新品识别：
真新品：新 ID + 新型号 → 标记为 🔥 新品发布。
重复铺货：新 ID + 旧型号 → 标记为 ♻️ 老品重发（精准识别马甲包）。
内容修改：旧 ID + 内容变动 → 标记为 ✏️ (内容变动)。
🛡️ 智能熔断防御机制：
当检测到大量商品（如 >8 个）同时排名上升时，自动触发**“历史档案核对”**。
如果 Ali 更新时间未变，系统将判定为**“被动位移”**（如删除上方商品导致），自动过滤，拒绝垃圾数据刷屏。
🎯 自动窗口锁定：
无需手动把标签页置顶。脚本启动时会自动遍历浏览器所有标签页，精准定位并激活阿里商品管理后台。
🧹 数据自动清洗：
自动吸尘：启动时自动清理 CSV 中的空行（防止 Excel 手动删除留下的坑）。
日期标准化：兼容 Excel 自动修改日期格式（如 2026/1/5 vs 2026-01-05），防止因格式问题导致误判。
⚡ 极速与稳定：
基于 CDP 协议连接本地 Chrome，不封号、不被检测。
支持防超时重试与万能滚动，网络卡顿也能稳定运行。
🛠️ 环境准备 (前置要求)
在使用本工具前，请确保你的电脑满足以下条件：
1. 安装 Python
下载并安装 Python 3.8 或更高版本。
安装时请勾选 Add Python to PATH。
2. 安装依赖库
在终端（CMD 或 PowerShell）中运行以下命令：
```pip install playwright pandas```
3. 配置“监控专用” Chrome 快捷方式 (关键步骤！)
本工具需要连接到一个开启了调试端口 (9222) 的 Chrome 浏览器。
在桌面找到 Google Chrome 图标，复制并粘贴，重命名为 “阿里监控专用”。
右键点击该图标 -> 属性。
在 “目标 (Target)” 一栏的末尾，添加一个空格，然后粘贴以下代码：
```--remote-debugging-port=9222 --user-data-dir="C:\ChromeDebug"```
示例完整路径: ```"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="C:\ChromeDebug"```
点击确定保存。
🚀 快速开始
第一步：启动浏览器
双击桌面上刚刚创建的 “阿里监控专用” Chrome 图标。
注意：这会打开一个全新的、干净的 Chrome 窗口，你需要重新登录阿里账号。
第二步：打开后台
登录阿里国际站，进入 My Alibaba -> 商品管理 -> 管理商品 (Manage Products) 页面，选择`上架(数量)`栏。
保持页面打开即可，无需保持在最前端，你可以去其他标签页工作。
第三步：运行脚本
在脚本所在文件夹打开终端，运行：
`python ali_monitor.py`
第四步：查看结果
脚本会自动在桌面（或配置的路径）生成 result.csv 文件。
建议：使用 Excel 打开查看，但不要在脚本运行时编辑保存，否则可能导致写入失败（建议复制一份查看）。
⚙️ 参数配置
在代码顶部的 配置区 可以修改常用参数：
```
# 1. 扫描频率 (秒)
CHECK_INTERVAL = 180  # 默认 3 分钟扫一次

# 2. 熔断阈值
# 当单次变动数超过此值时，启用严格审查，防止被动位移造成的误报
MASSIVE_THRESHOLD = 8

# 3. 结果保存路径
CSV_FILE_PATH = r"C:\Users\YourName\Desktop\AliMonitor\result.csv"
```
📊 报表字段说明
生成的 CSV 文件包含以下关键字段：
```字段	说明
ID	商品的唯一 Product ID
型号	抓取到的 Product Model
变化情况	🔥 新品发布 / ♻️ 老品重发 / ✏️ 修改详情 / 🚀 排名上升
Ali更新时间	阿里后台显示的最后更新日期
抓取时间	脚本发现变动的时间
标题/价格/负责人	商品的详细快照```

❓ 常见问题 (FAQ)
Q: 脚本报错 Permission denied？
A: 你正在用 Excel 打开 result.csv。Excel 会锁定文件，导致脚本无法写入。请关闭 Excel 后重试。
Q: 为什么我删除了上面的商品，下面的商品没有提示排名上升？
A: 这是 熔断机制 在工作。如果你删除了 10 个商品，导致下方 10 个商品被动上移，脚本会检测到这属于“非人为操作的大量位移”，并自动过滤掉，保证数据纯净。
Q: 既然能自动锁定窗口，我能最小化浏览器吗？
A: 不要最小化！ 最小化会导致 Chrome 冻结页面渲染，脚本可能无法抓取到完整数据。你可以把浏览器窗口挡在其他窗口后面，或者放在虚拟桌面里。
📜 免责声明
本工具仅用于辅助运营人员进行数据分析与店铺管理，不涉及任何爬虫攻击或破解行为。请遵守平台规则，合理使用。
