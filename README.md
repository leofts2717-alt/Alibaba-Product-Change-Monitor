# AliMonitor - 阿里国际站商品排名与变动监控系统

**AliMonitor** 是一套基于 Python + Playwright 的自动化监控解决方案，专为阿里国际站（Alibaba.com）运营人员设计。

它包含两个核心组件：
1.  **🚀 全量爬取工具 (Full Crawler V3.0)**：用于初次建立数据库，快速抓取店铺所有商品。(在另一个库里)
2.  **🛡️ 实时监控卫士 (Monitor V18.1)**：用于日常挂机，实时捕捉新品、修改和排名变动。

> **当前状态**: Stable / Production Ready
> **核心技术**: CDP 协议 / 智能窗口锁定 / 熔断防御 / 动态指纹去重

---

## ✨ 核心功能亮点

### 1. 🛡️ 实时监控脚本 (Monitor V18.1)
这是日常挂机使用的核心脚本，具备以下高级特性：

*   **🔥 智能新品识别**
    *   **真新品**：新 ID + 新型号 → 标记为 `🔥 新品发布`。
    *   **重复铺货**：新 ID + 旧型号 → 标记为 `♻️ 老品重发`（精准识别马甲包/复制发品）。
    *   **内容修改**：旧 ID + 内容变动 → 标记为 `✏️ (内容变动)`。
*   **⚡ 智能熔断防御 (Circuit Breaker)**
    *   当检测到大量商品（>8个）同时排名上升时，系统自动识别为**“被动位移”**（通常由删除上方商品导致）。
    *   **动作**：自动启动历史档案核对，如果 Ali 更新时间未变，自动过滤，**拒绝垃圾数据刷屏**。
*   **🎯 自动窗口锁定**
    *   无需手动置顶标签页。脚本启动时会自动遍历浏览器，**精准定位并激活**阿里后台窗口。
*   **🧹 数据自动清洗**
    *   **自动吸尘**：启动时自动清理 CSV 空行。
    *   **日期标准化**：兼容 Excel 格式（`2026/1/5` vs `2026-01-05`），防止误判。

### 2. 🚀 全量爬取脚本 (Crawler V3.0)
用于初始化或重建数据库：
*   **万能滚动**：支持容器滚动和 Window 全局滚动，适应各种网页加载情况。
*   **智能翻页**：自动识别翻页按钮状态，抓取全店数据。
*   **防崩设计**：强力等待机制，防止因网络卡顿导致的脚本崩溃。

---

## 🛠️ 环境准备 (前置要求)

在使用本工具前，请确保电脑满足以下条件：

### 1. 安装 Python
下载并安装 [Python 3.8 或更高版本](https://www.python.org/downloads/)。
*   ⚠️ **注意**：安装时务必勾选 `Add Python to PATH`。

### 2. 安装依赖库
在终端（CMD 或 PowerShell）中运行：
```bash
pip install playwright pandas
```

### 3. 配置“监控专用” Chrome (关键！)
本工具通过 CDP 协议连接浏览器，需要特殊的启动方式。

1.  复制桌面上的 Google Chrome 图标，重命名为 **“阿里监控专用”**。
2.  右键图标 -> **属性**。
3.  在 **“目标 (Target)”** 一栏末尾，**加一个空格**，粘贴以下内容：
    ```text
    --remote-debugging-port=9222 --user-data-dir="C:\ChromeDebug"
    ```
    *   *完整路径示例*: `"C:\Program Files\Google\Chrome\Application\chrome.exe" --remote-debugging-port=9222 --user-data-dir="C:\ChromeDebug"`
4.  点击 **应用** 和 **确定** 保存。

---

## 📖 使用指南

### 第一步：启动环境
双击桌面上刚刚创建的 **“阿里监控专用”** Chrome 图标。
*   *这会打开一个干净的浏览器窗口。*
*   登录阿里国际站，进入 **My Alibaba -> 商品管理 -> 管理商品 ->上架(数量)（一定要选中上架栏）** 页面。

### 第二步：选择模式运行

#### 🅰️ 模式一：初次使用 (全量抓取)
如果你是第一次使用，或者想重置数据库，请运行全量脚本：
```bash
python full_crawl.py
```
*   *注：假设你把 V3.0 脚本命名为 `full_crawl.py`*
*   它会翻页抓取店铺内所有商品，生成初始的 `result.csv`。

#### 🅱️ 模式二：日常监控 (实时挂机)
日常工作时，运行监控脚本：
```bash
python ali_monitor.py
```
*   *注：假设你把 V18.1 脚本命名为 `ali_monitor.py`*
*   它会每隔 3 分钟扫描一次第一页，只记录变动。

---

## ⚙️ 参数配置

在代码顶部的 `配置区` 可以修改常用参数：

```python
# --- ali_monitor.py ---

# 1. 扫描频率 (秒)
CHECK_INTERVAL = 180  # 默认 3 分钟

# 2. 熔断阈值 (条)
# 单次变动超过此值时，启用严格审查，防止被动位移误报
MASSIVE_THRESHOLD = 8

# 3. 结果保存路径
CSV_FILE_PATH = r"C:\Users\YourName\Desktop\AliMonitor\result.csv"
```

---

## 📊 报表字段说明

生成的 CSV 文件包含以下关键字段：

| 字段 | 说明 |
| :--- | :--- |
| **ID** | 商品唯一 Product ID |
| **型号** | 商品 Model |
| **变化情况** | `🔥 新品发布` / `♻️ 老品重发` / `✏️ 修改详情` / `🚀 排名上升` |
| **Ali更新时间** | 阿里后台显示的最后修改日期 |
| **抓取时间** | 脚本发现变动的时间 |
| **标题/价格/负责人** | 商品详细快照 |

---

## ❓ 常见问题 (FAQ)

**Q: 脚本报错 `Permission denied`？**
A: 你正在用 Excel 打开 `result.csv`。Excel 会锁定文件。请**关闭 Excel** 后重试。建议复制一份文件出来查看。

**Q: 我删了上面的商品，为什么下面的商品没有提示“排名上升”？**
A: 这是 **熔断机制** 在工作。脚本检测到非人为的大量位移（>8条），判定为被动变化，自动过滤了，保证数据纯净。

**Q: 既然能自动锁定窗口，我能最小化浏览器吗？**
A: **不要最小化！** 最小化会导致 Chrome 冻结页面渲染。请把浏览器窗口**挡在其他窗口后面**，或者放在虚拟桌面里。

**Q: 为什么刚启动时没有记录任何数据？**
A: 监控脚本是**增量模式**。启动时它会先读取 CSV 建立记忆。只有当页面发生**新变化**时，它才会写入数据。

---

## 📜 免责声明

本工具仅用于辅助运营人员进行数据分析与店铺管理，不涉及任何爬虫攻击、破解或绕过验证的行为。请遵守平台规则，合理使用。
